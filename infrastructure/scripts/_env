#!/usr/bin/env bash

#############################
# START OF USER CONFIGURATION
#############################

# Global
ARCH_SLUG=ombusite

# Environment specific variables
INFRASTRUCTURE_STACK_staging=ombu-services-development-1810311008
INFRASTRUCTURE_STACK_production=ombu-services-development-1810311008
SERVICES_STACK_staging=ombusite-services-staging-1902101136
SERVICES_STACK_production=
PIPELINE_STACK_staging=ombusite-pipeline-staging-1902101201
SERVICES_STACK_production=

###########################
# END OF USER CONFIGURATION
###########################

aws="docker run --rm -v ${PWD}:/tmp -w /tmp -e AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY -e AWS_DEFAULT_REGION ombu/docker-awscli aws"

if [[ -z ${SKIP_ENVIRONMENT_CHECK} ]]
then
    appEnv=$1
    if [[ "${appEnv}" != "staging" ]] && [[ "${appEnv}" != "production" ]]
    then
        echo "Unknown environment ${appEnv}"
        echo "The known environments are: staging, production"
        exit 1
    fi
fi

if [[ -n ${VALIDATE_COMPONENT} ]]
then
    component=$2
    if [[ "${component}" != "services" ]] && [[ "${component}" != "pipeline" ]]
    then
        echo "Unknown stack component ${component}"
        echo "The known components are: services, pipeline"
        exit 1
    fi
fi

# Convenience variables for scripts that source this one
_infrastructure_stack_name=INFRASTRUCTURE_STACK_${appEnv}
infrastructure_stack_name=${!_infrastructure_stack_name}
_services_stack_name=SERVICES_STACK_${appEnv}
services_stack_name=${!_services_stack_name}
_pipeline_stack_name=PIPELINE_STACK_${appEnv}
pipeline_stack_name=${!_pipeline_stack_name}

parameters="ParameterKey=EnvironmentType,ParameterValue=${appEnv} ParameterKey=InfrastructureStack,ParameterValue=${infrastructure_stack_name}"

#if [[ "$component" == 'services' ]] ; then
#fi
if [[ "$component" == 'pipeline' ]] ; then
    parameters="$parameters ParameterKey=ApplicationStack,ParameterValue=${services_stack_name}"
fi
